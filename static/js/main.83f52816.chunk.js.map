{"version":3,"sources":["components/StepSequencer/StepSequencer.js","App.js","index.js"],"names":["defaultProps","StepSequencer","useState","play","setPlay","players","setPlayers","sequencer","setSequencer","volumeDial","setVolumeDial","pianoRollRef","useRef","isStart","setIsStart","BPM","setBPM","rows","columns","beat","masterVolume","setMasterVolume","volNode","setVolNode","seqRef","volumeRef","useEffect","Tone","toDestination","urls","0","1","2","3","baseUrl","connect","undefined","volume","value","id","current","Nexus","Sequencer","size","mode","paddingRow","paddingColumn","colorize","rects","getElementsByTagName","i","length","rect","Math","floor","setAttribute","matrix","set","all","destroy","Dial","interaction","min","max","on","v","configLoop","bpm","scheduleRepeat","time","next","rawContext","ev","console","log","pattern","forEach","row","index","synth","player","start","className","ref","editMode","style","overflowY","xRange","yRange","width","xScroll","yScroll","wheelZoom","markStart","markEnd","collt","coldk","colgrid","colnote","colnotesel","colnoteborder","colrulerbg","colrulerfg","kbwidth","flexDir","mt","w","defaultValue","step","onChange","colorScheme","onClick","e","stop","pl","pr","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.83f52816.chunk.js","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { Button, Slider, SliderTrack, SliderFilledTrack, SliderThumb, Flex } from '@chakra-ui/react';\nimport * as Tone from 'tone';\nimport 'webaudio-pianoroll';\nimport Nexus from 'nexusui';\nimport './StepSequencer.scss';\n\nconst defaultProps = {\n  BPM: 120,\n  minBPM: 60,\n  maxBPM: 240,\n  BPMStep: 1,\n  rows: 4,\n  columns: 16,\n  beatOffset: 0,\n};\n\nconst StepSequencer = () => {\n  const [play, setPlay] = useState(false);\n  const [players, setPlayers] = useState();\n  const [sequencer, setSequencer] = useState();\n  const [volumeDial, setVolumeDial] = useState();\n  const pianoRollRef = useRef();\n  const [isStart, setIsStart] = useState(false);\n  const [BPM, setBPM] = useState(defaultProps.BPM);\n  const [rows, setRows] = useState(defaultProps.rows);\n  const [columns, setColumns] = useState(defaultProps.columns);\n  let [beat, setBeat] = useState(defaultProps.beatOffset);\n  let [masterVolume, setMasterVolume] = useState(0.0);\n  const [volNode, setVolNode] = useState();\n  const seqRef = useRef();\n  const volumeRef = useRef();\n\n  useEffect(() => {\n    // const players = new Tone.Players({\n    //   urls: {\n    //     0: 'A1.mp3',\n    //     1: 'Cs2.mp3',\n    //     2: 'E2.mp3',\n    //     3: 'Fs2.mp3',\n    //   },\n    //   fadeOut: '64n',\n    //   baseUrl: 'https://tonejs.github.io/audio/casio/',\n    // }).toDestination();\n    const volNode = new Tone.Volume(masterVolume).toDestination();\n    setVolNode(volNode);\n    const players = new Tone.Players({\n      urls: {\n        0: 'kick.mp3',\n        1: 'hihat.mp3',\n        2: 'snare.mp3',\n        3: 'tom1.mp3',\n      },\n      // fadeOut: '64n',\n      // baseUrl: 'https://github.com/Tonejs/audio/tree/master/drum-samples/acoustic-kit/',\n      baseUrl: 'https://tonejs.github.io/audio/drum-samples/acoustic-kit/',\n    }).connect(volNode);\n    setPlayers(players);\n\n    return () => {\n      setPlayers(undefined);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (volNode) volNode.volume.value = masterVolume;\n  }, [masterVolume, volNode]);\n\n  useEffect(() => {\n    const id = seqRef?.current?.id;\n    const sequencer = new Nexus.Sequencer(id, {\n      size: [500, 160],\n      mode: 'toggle',\n      rows,\n      columns,\n      paddingRow: 5,\n      paddingColumn: 5,\n    });\n    sequencer.colorize('fill', '#51575B');\n    sequencer.colorize('accent', '#AABAC4');\n    const rects = seqRef.current.getElementsByTagName('rect');\n\n    for (let i = 0; i < rects.length; i++) {\n      const rect = rects[i];\n      const rem = Math.floor(i / 4);\n      rect.setAttribute('rx', 4);\n      if (rem % 2 === 1) {\n        // rect.setAttribute('fill', '#6C5B5C');\n      }\n    }\n    // sequencer.on('change', (v) => console.log(v));\n    sequencer.matrix.set.all([\n      [1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],\n      [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0],\n      [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0],\n      [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    ]);\n\n    setSequencer(sequencer);\n\n    return () => {\n      sequencer.destroy();\n      setSequencer(undefined);\n    };\n  }, [seqRef]);\n\n  useEffect(() => {\n    const id = volumeRef.current.id;\n    const dial = new Nexus.Dial(id, {\n      size: [75, 75],\n      interaction: 'radial', // \"radial\", \"vertical\", or \"horizontal\"\n      mode: 'relative', // \"absolute\" or \"relative\"\n      min: -60,\n      max: 5.6,\n      value: 0,\n    });\n    dial.on('change', (v) => {\n      setMasterVolume(v);\n    });\n\n    return () => {\n      setVolumeDial(undefined);\n      volumeDial.destroy();\n    };\n  }, [volumeRef]);\n\n  const onClick = (e) => {\n    if (!isStart) {\n      Tone.start();\n      setIsStart(true);\n      configLoop(sequencer);\n    }\n    if (!play) {\n      Tone.Transport.start();\n    } else {\n      Tone.Transport.stop();\n      pianoRollRef.current.stop();\n    }\n    setPlay(!play);\n  };\n\n  const configLoop = (sequencer) => {\n    const repeat = (time) => {\n      sequencer.next();\n      pianoRollRef.current.play(Tone.getContext().rawContext, (ev) => {\n        console.log(ev);\n      });\n      const grid = sequencer.matrix.pattern;\n      grid.forEach((row, index) => {\n        let synth = players.player(index);\n        let note = row[beat];\n        if (note) synth.start(time, 0, '1n');\n      });\n\n      beat = (beat + 1) % columns;\n    };\n\n    Tone.Transport.bpm.value = BPM;\n    Tone.Transport.scheduleRepeat(repeat, '16n');\n  };\n\n  const onBPMSliderChange = (value) => {\n    Tone.Transport.bpm.value = value;\n    setBPM(value);\n  };\n\n  return (\n    <div className=\"step-sequencer-container\">\n      <webaudio-pianoroll\n        ref={pianoRollRef}\n        editMode=\"dragpoly\"\n        style={{ overflowY: 'scroll' }}\n        xRange={256}\n        yRange={20}\n        width=\"1000\"\n        xScroll={1}\n        yScroll={1}\n        wheelZoom={1}\n        markStart={0}\n        markEnd={256}\n        collt=\"#34444E\"\n        coldk=\"#2E3E48\"\n        colgrid=\"#24343E\"\n        colnote=\"#A4D4AD\"\n        colnotesel=\"#AFD4BA\"\n        colnoteborder=\"#A4D4AD\"\n        colrulerbg=\"#1F2A32\"\n        colrulerfg=\"#b0b0b0\"\n        // colrulerborder=\"pink\"\n        kbwidth=\"80\"\n      ></webaudio-pianoroll>\n      <Flex flexDir=\"column\" mt={5}>\n        <h3>{BPM} BPM</h3>\n        <Slider w=\"500px\" defaultValue={defaultProps.BPM} min={defaultProps.minBPM} max={defaultProps.maxBPM} step={defaultProps.BPMStep} onChange={onBPMSliderChange}>\n          <SliderTrack>\n            <SliderFilledTrack />\n          </SliderTrack>\n          <SliderThumb />\n        </Slider>\n        <Button colorScheme=\"blue\" onClick={onClick} pl={100} pr={100}>\n          {play ? 'Pause' : 'Play'}\n        </Button>\n        <Flex id=\"volumne\" mt={5} ref={volumeRef}></Flex>\n        <Flex id=\"sequencer\" mt={5} ref={seqRef}></Flex>\n      </Flex>\n    </div>\n  );\n};\n\nexport default StepSequencer;\n","import { ChakraProvider } from '@chakra-ui/react';\nimport './App.scss';\nimport StepSequencer from './components/StepSequencer/StepSequencer';\n\nfunction App() {\n  return (\n    <ChakraProvider>\n      <div className=\"App\">\n        <StepSequencer />\n      </div>\n    </ChakraProvider>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}