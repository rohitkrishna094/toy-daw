{"version":3,"sources":["components/StepSequencer/StepSequencer.js","App.js","index.js"],"names":["defaultProps","StepSequencer","useState","play","setPlay","players","setPlayers","sequencer","setSequencer","setOscilloscope","volumeDial","setVolumeDial","pianoRollRef","useRef","isStart","setIsStart","BPM","setBPM","rows","columns","beat","masterVolume","setMasterVolume","volNode","setVolNode","seqRef","volumeRef","oscilloscopeRef","useEffect","Tone","toDestination","urls","0","1","2","3","baseUrl","connect","undefined","volume","value","id","current","Nexus","Sequencer","size","mode","paddingRow","paddingColumn","colorize","rects","getElementsByTagName","i","length","rect","Math","floor","setAttribute","matrix","set","all","destroy","oscilloscope","Oscilloscope","Dial","interaction","min","max","on","v","configLoop","bpm","scheduleRepeat","time","next","rawContext","ev","console","log","pattern","forEach","row","index","synth","player","start","className","ref","editMode","style","overflowY","xRange","yRange","width","xScroll","yScroll","wheelZoom","markStart","markEnd","collt","coldk","colgrid","colnote","colnotesel","colnoteborder","colrulerbg","colrulerfg","kbwidth","flexDir","mt","w","defaultValue","step","onChange","colorScheme","onClick","e","stop","pl","pr","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.b08a2af0.chunk.js","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { Button, Slider, SliderTrack, SliderFilledTrack, SliderThumb, Flex } from '@chakra-ui/react';\nimport * as Tone from 'tone';\nimport 'webaudio-pianoroll';\nimport Nexus from 'nexusui';\nimport './StepSequencer.scss';\n\nconst defaultProps = {\n  BPM: 120,\n  minBPM: 60,\n  maxBPM: 240,\n  BPMStep: 1,\n  rows: 4,\n  columns: 16,\n  beatOffset: 0,\n};\n\nconst StepSequencer = () => {\n  const [play, setPlay] = useState(false);\n  const [players, setPlayers] = useState();\n  const [sequencer, setSequencer] = useState();\n  const [oscilloscope, setOscilloscope] = useState();\n  const [volumeDial, setVolumeDial] = useState();\n  const pianoRollRef = useRef();\n  const [isStart, setIsStart] = useState(false);\n  const [BPM, setBPM] = useState(defaultProps.BPM);\n  const [rows, setRows] = useState(defaultProps.rows);\n  const [columns, setColumns] = useState(defaultProps.columns);\n  let [beat, setBeat] = useState(defaultProps.beatOffset);\n  let [masterVolume, setMasterVolume] = useState(0.0);\n  const [volNode, setVolNode] = useState();\n  const seqRef = useRef();\n  const volumeRef = useRef();\n  const oscilloscopeRef = useRef();\n\n  useEffect(() => {\n    // const players = new Tone.Players({\n    //   urls: {\n    //     0: 'A1.mp3',\n    //     1: 'Cs2.mp3',\n    //     2: 'E2.mp3',\n    //     3: 'Fs2.mp3',\n    //   },\n    //   fadeOut: '64n',\n    //   baseUrl: 'https://tonejs.github.io/audio/casio/',\n    // }).toDestination();\n    const volNode = new Tone.Volume(masterVolume).toDestination();\n    setVolNode(volNode);\n    const players = new Tone.Players({\n      urls: {\n        0: 'kick.mp3',\n        1: 'hihat.mp3',\n        2: 'snare.mp3',\n        3: 'tom1.mp3',\n      },\n      // fadeOut: '64n',\n      // baseUrl: 'https://github.com/Tonejs/audio/tree/master/drum-samples/acoustic-kit/',\n      baseUrl: 'https://tonejs.github.io/audio/drum-samples/acoustic-kit/',\n    }).connect(volNode);\n    setPlayers(players);\n\n    return () => {\n      setPlayers(undefined);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (volNode) volNode.volume.value = masterVolume;\n  }, [masterVolume, volNode]);\n\n  useEffect(() => {\n    const id = seqRef?.current?.id;\n    const sequencer = new Nexus.Sequencer(id, {\n      size: [500, 160],\n      mode: 'toggle',\n      rows,\n      columns,\n      paddingRow: 5,\n      paddingColumn: 5,\n    });\n    sequencer.colorize('fill', '#51575B');\n    sequencer.colorize('accent', '#AABAC4');\n    const rects = seqRef.current.getElementsByTagName('rect');\n\n    for (let i = 0; i < rects.length; i++) {\n      const rect = rects[i];\n      const rem = Math.floor(i / 4);\n      rect.setAttribute('rx', 4);\n      if (rem % 2 === 1) {\n        // rect.setAttribute('fill', '#6C5B5C');\n      }\n    }\n    // sequencer.on('change', (v) => console.log(v));\n    sequencer.matrix.set.all([\n      [1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],\n      [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0],\n      [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0],\n      [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    ]);\n\n    setSequencer(sequencer);\n\n    return () => {\n      sequencer.destroy();\n      setSequencer(undefined);\n    };\n  }, [seqRef]);\n\n  useEffect(() => {\n    const id = oscilloscopeRef.current;\n    const oscilloscope = new Nexus.Oscilloscope(id);\n    oscilloscope.connect(Tone.Destination);\n    setOscilloscope(oscilloscope);\n\n    return () => {\n      oscilloscope.destroy();\n      setOscilloscope(undefined);\n    };\n  }, [oscilloscopeRef]);\n\n  useEffect(() => {\n    const id = volumeRef.current.id;\n    const dial = new Nexus.Dial(id, {\n      size: [75, 75],\n      interaction: 'radial', // \"radial\", \"vertical\", or \"horizontal\"\n      mode: 'relative', // \"absolute\" or \"relative\"\n      min: -60,\n      max: 5.6,\n      value: 0,\n    });\n    dial.on('change', (v) => {\n      setMasterVolume(v);\n    });\n\n    return () => {\n      setVolumeDial(undefined);\n      volumeDial.destroy();\n    };\n  }, [volumeRef]);\n\n  const onClick = (e) => {\n    if (!isStart) {\n      Tone.start();\n      setIsStart(true);\n      configLoop(sequencer);\n    }\n    if (!play) {\n      Tone.Transport.start();\n    } else {\n      Tone.Transport.stop();\n      pianoRollRef.current.stop();\n    }\n    setPlay(!play);\n  };\n\n  const configLoop = (sequencer) => {\n    const repeat = (time) => {\n      sequencer.next();\n      pianoRollRef.current.play(Tone.getContext().rawContext, (ev) => {\n        console.log(ev);\n      });\n      const grid = sequencer.matrix.pattern;\n      grid.forEach((row, index) => {\n        let synth = players.player(index);\n        let note = row[beat];\n        if (note) synth.start(time, 0, '1n');\n      });\n\n      beat = (beat + 1) % columns;\n    };\n\n    Tone.Transport.bpm.value = BPM;\n    Tone.Transport.scheduleRepeat(repeat, '16n');\n  };\n\n  const onBPMSliderChange = (value) => {\n    Tone.Transport.bpm.value = value;\n    setBPM(value);\n  };\n\n  return (\n    <div className=\"step-sequencer-container\">\n      <webaudio-pianoroll\n        ref={pianoRollRef}\n        editMode=\"dragpoly\"\n        style={{ overflowY: 'scroll' }}\n        xRange={256}\n        yRange={20}\n        width=\"1000\"\n        xScroll={1}\n        yScroll={1}\n        wheelZoom={1}\n        markStart={0}\n        markEnd={256}\n        collt=\"#34444E\"\n        coldk=\"#2E3E48\"\n        colgrid=\"#24343E\"\n        colnote=\"#A4D4AD\"\n        colnotesel=\"#AFD4BA\"\n        colnoteborder=\"#A4D4AD\"\n        colrulerbg=\"#1F2A32\"\n        colrulerfg=\"#b0b0b0\"\n        // colrulerborder=\"pink\"\n        kbwidth=\"80\"\n      ></webaudio-pianoroll>\n      <Flex flexDir=\"column\" mt={5}>\n        <h3>{BPM} BPM</h3>\n        <Slider w=\"500px\" defaultValue={defaultProps.BPM} min={defaultProps.minBPM} max={defaultProps.maxBPM} step={defaultProps.BPMStep} onChange={onBPMSliderChange}>\n          <SliderTrack>\n            <SliderFilledTrack />\n          </SliderTrack>\n          <SliderThumb />\n        </Slider>\n        <Flex id=\"oscilloscope\" ref={oscilloscopeRef}></Flex>\n        <Button colorScheme=\"blue\" onClick={onClick} pl={100} pr={100}>\n          {play ? 'Pause' : 'Play'}\n        </Button>\n        <Flex id=\"volumne\" mt={5} ref={volumeRef}></Flex>\n        <Flex id=\"sequencer\" mt={5} ref={seqRef}></Flex>\n      </Flex>\n    </div>\n  );\n};\n\nexport default StepSequencer;\n","import { ChakraProvider } from '@chakra-ui/react';\nimport './App.scss';\nimport StepSequencer from './components/StepSequencer/StepSequencer';\n\nfunction App() {\n  return (\n    <ChakraProvider>\n      <div className=\"App\">\n        <StepSequencer />\n      </div>\n    </ChakraProvider>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}